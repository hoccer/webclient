<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Hoccer Webclient</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Robert Palmer">
	<!-- Date: 2010-12-15 -->
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	
	<script src="lib/linccer/lib/jquery-1.4.4.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/linccer/lib/base.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/linccer/lib/linccer.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/linccer/lib/filecache.js" type="text/javascript" charset="utf-8"></script>
	<script src="webclient.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" charset="utf-8">	
		$(document).ready(function() {
			var fileCache = FileCache( {'api_key': 'e101e890ea97012d6b6f00163e001ab0', 'server': 'beta' });			
			var linccer = Linccer( {'api_key' : 'e101e890ea97012d6b6f00163e001ab0', 'server': 'beta'});

			var map = HoccerMap('map_canvas');
			var client = WebClient(map);
		 	
		  map.on('position_changed', function() {
				linccer.setEnvironmentCoordinates(map.latitude, map.longitude, 100);
			});
			
			map.on('address_changed', function(address) {
				$("#coordinates").text(address);
			})
		
		  client.on('send', function() {
				var content = document.getElementById("fileInputField").value;
				var data = [
				   {
						"type": "text/plain",
						"content": content
						}
				];

				linccer.send("one-to-many", data);
			});

			client.on('receive', function() {
				linccer.receive("one-to-many")
			});
			
			fileCache.on('started', function(url) {
				console.log('started:' + url);
			});
			
			fileCache.on('progress', function(progress) {
				// console.log(progress);
			});

			fileCache.on('uploaded', function(uri) {
		    console.log("uploaded: " + uri);
			});
			
			linccer.on('sent', function(data) {
				console.log("sent!!!!!! " + data);
			});
			
			linccer.on('ready', function() {
				client.displayLocation();
			})
			
			linccer.on('updated_environment', function(data) {
				console.log('updated environments!!!!!');
				map.setCenter(data.gps.latitude, data.gps.longitude)
			});
			
			linccer.on('received', function(data) {
				console.log(data);
				document.getElementById("input").value = data[0][0].content;
			});
			
			linccer.on('error', function(error) {
				console.log(error);
			});
						
			$("#fileInputField").change(function() {
				var file = document.getElementById('fileInputField').files[0];
				fileCache.upload(file);
			});				
		});
		

		
	</script>
	
	<style type="text/css" media="screen">
	
		#content { width: 700px; margin: 0 auto}
		#content > div { margin-top: 20px;}
		#location #coordinates { display: none; }
		
		#map_canvas { height: 450px; }
		#map_container { margin-top: -1000px; }
		
		div.fileinputs {
			position: relative;
		}

		div.fakefile {
			position: absolute;
			top: 0px;
			left: 0px;
			z-index: 1;
		}

		input.file {
			position: relative;
			text-align: right;
			-moz-opacity:0 ;
			filter:alpha(opacity: 0);
			opacity: 0;
			z-index: 2;
		}
	</style>
	
</head>
<body>

	<div id="content">
		<div id="location">
			<span id="waiting">locating...</span>
			<span id="coordinates">32,12 1212</span>
			
			<span id="show_map"><a href="#">showMap</a></span>
			<div id="map_container">
				<form id="addressForm"><input id="addressInput" type="text" /><input type="Submit" value="search" /></form>
				<div id="map_canvas">
				</div>
			</div>
		</div>

		<div>			
			<div class="fileinputs">
				<input type="file" class="file" />
				<div class="fakefile">
					<img style="background-color: red; width: 30px; height: 30px" />
				</div>
			</div>

		</div>
		
		<div>
			<a href="#" id="receiveButton">Receive</a>
			<a href="#" id="sendButton">Send</a>
		</div>



</div>
</body>
</html>
