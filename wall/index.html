<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Hoccer Wall</title>
  <meta name="generator" content="TextMate http://macromates.com/">
  <meta name="author" content="Robert Palmer">
  <!-- Date: 2010-12-15 -->
  <script src="http://hoccer.com/webapp/lib/linccer/lib/jquery-1.4.4.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://hoccer.com/webapp/lib/linccer/lib/json_parse.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://hoccer.com/webapp/lib/linccer/lib/base.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://hoccer.com/webapp/lib/linccer/lib/linccer.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://hoccer.com/webapp/lib/linccer/lib/filecache.js" type="text/javascript" charset="utf-8"></script>
  <script src="http://hoccer.com/webapp/hoccer_map.js" type="text/javascript" charset="utf-8"></script>
  <script src="lib/jquery.iphone-switch.js" type="text/javascript" charset="utf-8"></script>
  <script src="lib/jquery.iCheckbox.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" src="http://jquery-jsonp.googlecode.com/files/jquery.jsonp-1.0.4.min.js"></script>
  <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
  <script type="text/javascript" charset="utf-8">
    $(document).ready(function() {
      var MAX_HEIGHT = $(document).height() - 200,
          MAX_WIDTH = $(document).width() - 300,
          MAX_ROTATION = 15,
          MAX_ELEMENTS = 6;

      var LOCATION_ERROR = 'Could not locate you. Please set your location manually.',
          TIMEOUT_ERROR = 'No transfer partner found';

      var linccer = Linccer( {"api_key" : "b3b03410159c012e7b5a00163e001ab0" });
      var images = [],
          iframeDiv,
          map = HoccerMap("map_canvas", "address_field");

      var last_sender = "",
          allowed_sender = "";

      map.show();
      linccer.setEnvironmentCoordinates(52.51666009426117, 13.40919971466064, 2000);

      var audio = new Audio();
      audio.src = "image-hitting-the-wall.wav";
      
      var scaleImage = function(img) {

        var factor = 1;
        if (img.width > img.height) {
          factor = MAX_WIDTH / img.width;
        } else {
          factor = MAX_HEIGHT / img.height;
        }

        img.width *= factor;
        img.height *= factor;

        factor = 1;
        if (img.width > MAX_WIDTH){
          factor = MAX_WIDTH / img.width;
        } else if (img.height > MAX_HEIGHT){
          factor = MAX_HEIGHT / img.height;
        }

        img.width *= factor;
        img.height *= factor;

      };

      var positionForElement = function(element) {
        var doc = $(window);

        var top = doc.height() / 2 - element.height() / 2;
        var left = doc.width() / 2 - element.width() / 2;

        return { 'top': top + 'px', 'left': left+'px' };
      };

      var addImage = function(uri, preview) {        
        var div,
            rotation = Math.floor(Math.random() * 16) * ((Math.floor(Math.random() * 2) - 1) | 1),
        dropImage = function( img ) {
          setTimeout(function() {
            audio.play();
          }, 300);
                      
          div = $("<div></div")
                  .append(img)
                  .attr('class', 'image')
                  .css({ '-webkit-transform': 'rotate(' + rotation + 'deg)' })
                  .css({ '-moz-transform': 'rotate(' + rotation + 'deg)' })
                  .css({ 'height': '2000px', 'width': '2000px'})
                  .css({ 'opacity': '0'})
                  .appendTo('#wall');

          var position = positionForElement($(img));

          div
            .css({ '-webkit-transition-property': 'opacity, top, left, width, height' })
            .css({ '-webkit-transition-duration': '0.3s' })
            .css({ 'width': img.width, 'height': img.height})
            .css({ 'opacity': '1'})
            .css(position);

          $(img).css({ 'width': '100%', 'height': '100%'});
          
          images.push(div);
          if (images.length > MAX_ELEMENTS) {
            $(images.shift()).remove();
          }
        }
        
        if (preview !== undefined) {
          var previewImg = new Image();
          previewImg.src = preview[0].uri;
          previewImg.onload = function() {
            if (div === undefined) {
              scaleImage(previewImg);
              dropImage(previewImg);
            }
          };
        }
        
        var img = new Image();
        img.src = uri;
        img.onload = function() {
          scaleImage(img);
          
          if (div === undefined) {
            dropImage(img);
          } else {
            div.html("")
               .css('-webkit-transition-property', 'opacity' )
               .css({ 'width': img.width, 'height': img.height})
               .append(img);
               
            div.css(positionForElement($(img)));
          };
          
        };
        

        return div;
      };

      var addYoutube = function(uri) {
        var iframe = $('<iframe title="YouTube video player" width="853" height="510" src="'
                          + uri + '?rel=0&autoplay=1" frameborder="0"></iframe>');

        iframeDiv = $("<div></div").
            append(iframe).
            attr('class', 'image').
            appendTo('#wall');
        
        var position = positionForElement(iframe);
        iframeDiv.css(position);
      };

      var watch = function() {
        linccer.receive( 'one-to-many', { 'waiting': 'true', 'timeout': 15000 } );
      };

      linccer.on('ready', function() {
        watch();
      });

      linccer.on('received', function(data) {
        last_sender = data[0]['sender']['client-id']
        if (allowed_sender != last_sender && allowed_sender != ""){
          watch();
          return;
        }

        if (iframeDiv !== undefined) {
          $(iframeDiv).remove();
          iframeDiv = undefined;
        }
        
        var firstContent = data[0]['data'][0],
            preview = firstContent.preview;
        
        if (firstContent.type.match(/^image\/*/)) {
          addImage(firstContent.uri, preview);
        } else if (firstContent.type === 'text/uri-list' && firstContent.content.match(/www\.youtube\.com/)) {

        var uri = firstContent.content.replace("watch?v=", "embed/");
          addYoutube(uri);
        };

        watch();
      });

      linccer.on('error', function(error) {
        if (error.code == 3 || error.code == 1) {
          $("#settings").show();
          map.show();
        } else if (error.message === 'request_timeout') {
          setTimeout( function() { watch(); }, 100);
        }
      });

      linccer.on('updated_environment', function(data) {
        map.setCenter(data.gps.latitude, data.gps.longitude)
      });

      map.on('position_changed', function() {
        linccer.setEnvironmentCoordinates(map.latitude, map.longitude, 300);
      });

      $("#info_button").click(function() {
        $("#settings").show();
        google.maps.event.trigger(map, 'resize');
        map.show();

        return false;
      });

      $("#done").click(function() {
        var bssids = $("#bssid_field").val().split(",");
        
        var cleanedIds = [];
        for (var i = 0; i < bssids.length; i++) {
          cleanedIds.push(bssids[i].trim());
        }
        linccer.setBssids( cleanedIds );
        
        $("#settings").hide();
        return false;
      });
      
      $("#legal_notice").click(function() {
        $("#legal").toggle();
        return false;
      });
      
      $("#close_legal").click(function() {
        $("#legal").hide();
        return false;
      });
      
      $("#show_hotspots").click( function() {
        $(this).hide();
        $("#bssid div").show();
        
        return false;
      });
      
      $('#lock_wall').iCheckbox("off", {switch_speed: 50 });
		  $('#lock_wall').change(function(e){
			  if ( $('#lock_wall').attr('checked') == true ) {
			  	allowed_sender = last_sender;
			  } else {
			  	allowed_sender = "";
        }
		  });

    });

  </script>

  <style type="text/css" media="screen">
    html, body {
      padding 0; margin: 0;
      height: 100%;
      
      color: white;
      font: 100% "Helvetica", "Lucida Grande", sans-serif;
      overflow: hidden;
    }

    #wall {
      background: #DDD url('http://hoccer.com/webapp/images/hoccer_wall_bg.jpg') repeat-x;
      height: 100%;
      width: 100%;
    }

    #logo {
      padding: 20px;
    }

    #info_button {
      position: absolute;
      bottom: 10px;
      right: 10px;
    }
    
    #legal_notice {
      position: absolute;
      bottom: 30px;
      left: 30px; 
      font-size: 0.7em;     
    }
    
    .image {
      position: absolute;
      margin: auto;
      background-color: white;

      padding: 10px;
    }
    
    #manual {
      float: right;
      padding: 30px 50px;
      width: 350px;
      font-size: 1.3em;
      
      text-shadow: #000 2px 2px 2px;
      color: #ececec;
    }
    
    #settings {
      position: absolute;
      top: 0; right: 0;
      
      width: 496px;
      height: 100%;
      z-index : 1;
      
      padding: 0 25px;
      
      display: none;
    }

    .settings_option {
      margin-left: 4px;
      margin-bottom: 20px;
      font-size: 1.3em;
      height:30px;
      width: 488px;
    }

    #done {
      bottom: 20px;
      right: 20px;
      position: absolute;
    }

    #map_canvas {
      margin: 10px auto;
      width : 488px;
      height: 350px;
    }

    #address_field {
      width: 485px;
      margin: 0px;
      margin-bottom: 20px;
    }

    a, a img, a:active img, a:visited {
      color: #fff;
      border: 0;
    }

    img#scalable_image, img#select_bg_image {
      position: absolute;
      top:0;
      left:0;
      width: 100%;
      height: 100%;

      z-index: -1;
    }
    
    input {
      font-size: 15pt;
    }
    
    #bssid {
      position: absolute;
      bottom: 28px;
      
      font-size: 0.85em;
      width: 350px;
    }
    
    #bssid div {
      display: none;
    }
    
    #bssid_field {
      width: 320px;
    }
    
    #legal {
      position: absolute;
      left: 80px;
      bottom: 120px;

      font-size: 0.90em;
      color: #000;

      width: 360px;
      height: 370px;
      padding: 30px;
      
      background: white;
      
      display: none;
    }
    
    #close_legal {
      position: relative;
      top: -20px;
    }
    
    #close_legal a:visited {
      color: blue;
    }
    
    .iCheckbox_container {
		height:27px;
		width:94px;
		position: relative;
		overflow: hidden;
    float:right;
	}

	.iCheckbox_switch {
		height:27px;
		width:94px;
		background-image:url(images/iphone_switch.png); /* your actual slider image */
		background-repeat:none;
		background-position:0px;
	  float:right;
	}

  .iCheckbox_checkbox { 
     visibility:hidden; 
     width:0px;
     margin:0px;
     display:none;
	}
  </style>
  <body>
    <div id="legal">
      <!-- <div id="close_legal"><a href="#">close</a></div> -->
      Legal notice:

      Hoccer Wall is a product by Hoccer GmbH, Berlin. Use at your own risk. This
      website may contain explicit or offensive content by third-party websites or
      users that might offend sensibilities. These contents do NOT constitute any
      endorsement of the content of these websites or users and are intended only
      to facilitate the usage of the Hoccer Wall for visitors of this website.
      Hoccer GmbH does NOT OWN OR CONTROL the pusblished content and assumes no
      liability for their content or information. The administrators of content
      are solely responsible for their content and the usage of these contents is
      at the visitor's own risk. Should you notice that our website shows content
      which is against the law, please notify us immediately
      <a href="mailto:info@hoccer.com">info@hoccer.com</a>. We will try to remove these contents from our
      website. Anyhow, Hoccer GmbH can NOT provide any support for the content
      made available for download, nor take any responsibility for offended
      sensibilities. Furthermore, Hoccer GmbH takes NO legal liability for any
      possible damage that is caused by the usage of the provided website.
    </div>
    
    <div id="wall">
      <img src="http://hoccer.com/webapp/images/logo.png" id="logo" width="256" height="64" alt="Logo">
      <div id="manual">Throw images on this wall by using Hoccer for iPhone or Android</div>
      <a id="info_button" href="#"><img src="http://hoccer.com/webapp/images/i.png" width="46" height="46" alt="info"></a>
      <a href="#" id="legal_notice">Legal Notice</a>
    </div>

    <div id="settings">
      <h1>Settings</h1>
        <div id="map_canvas"></div>
      <div class="settings_option">
        <input id="address_field" type="text" value="" placeholder="Manually enter address"/><br>
      </div>
      <div class="settings_option"></div>
      <div class="settings_option">
        <input type="checkbox" id="lock_wall" />Restrict to last thrower
      </div>

      <a id="done" href="#"><img src="http://hoccer.com/webapp/images/done.png" width="130" height="52" alt="Done"></a>
      
      <div id="bssid">
        <a href="" id="show_hotspots">Enter Hotspot</a>
        <div>
          <input id="bssid_field" type="text" value="" placeholder="00:00:00:00:00:00, 00:00:00:00:00"/>
          <p>Enter BSSIDs of nearby hotspots to enhance the connection between mobiles and this image wall.</p>
        </div>
      </div>
      
      <img src="http://hoccer.com/webapp/images/bg_settings.jpg" id="select_bg_image">
    </div>
    
    <!-- Piwik --> 
    <script type="text/javascript">
    	var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.hoccer.com/" : "http://stats.hoccer.com/");
    	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
    	</script><script type="text/javascript">
    	try {
    	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 2);
    	piwikTracker.trackPageView();
    	piwikTracker.enableLinkTracking();
    	} catch( err ) {}
    </script><noscript><p><img src="http://stats.hoccer.com/piwik.php?idsite=2" style="border:0" alt="" /></p></noscript>
    <!-- End Piwik Tracking Tag -->

  </body>

</html>
