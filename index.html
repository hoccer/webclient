<!DOCTYPE html>
<html lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Hoccer Webapp</title>
	<meta name="generator" content="MacVim">
  <meta name="author" content="Martin Delius">
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />
  
	<!-- Date: 2010-12-15 -->
	<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
	<script src="lib/linccer/lib/json_parse.js" type="text/javascript" charset="utf-8"></script>
	
	<script src="lib/linccer/lib/jquery-1.4.4.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="http://jquery-jsonp.googlecode.com/files/jquery.jsonp-1.0.4.min.js"></script>
	
	<script src="shadowbox/shadowbox.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/linccer/lib/base.js" type="text/javascript" charset="utf-8"></script>
	
	<script src="lib/linccer/lib/linccer.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/linccer/lib/filecache.js" type="text/javascript" charset="utf-8"></script>
	<script src="hoccer_map.js" type="text/javascript" charset="utf-8"></script>
  <script src="mobile.js" type="text/javascript" charset="utf-8"></script>
  <script src="webclient.js" type="text/javascript" charset="utf-8"></script>
  <script type="text/javascript" charset="utf-8">	

    var fileCache, linccer, client, group, myname, payload;

    var selected_clients = [];
    var selected_name = "";

    $(document).ready(function() {

			var LOCATION_ERROR = 'Could not locate you. Please set your location manually.';
			var TIMEOUT_ERROR = 'No transfer partner found';

			fileCache = FileCache( {'api_key': 'b3b03410159c012e7b5a00163e001ab0' });
			linccer = Linccer( {'api_key' : 'b3b03410159c012e7b5a00163e001ab0' });

			var map = HoccerMap('map_canvas');
			client = WebClient(map);
		 	client.setInactive();
		
      client.showHelp();
      
      var content;

      var groupid = "";

      myname = "<WebApp>";

      linccer.setName(myname);

      myname = myname.replace(/</g,"");
      myname = myname.replace(/>/g,"");

      var actname = document.getElementById('my_name');

      actname.innerHTML = '<b>App Name: </b>' + myname; 

      linccer.peek(groupid);

      setInterval( "watch()" , 5000 );
      setInterval( "poke()" , 5000 );

      var myid = linccer.getID();

			var showImage = function(uri) {
				Shadowbox.open({
					content: uri,
					player : "img"
				});
				
			}
		
			var showDownload = function(uri) {
				window.location = uri;
			}
			
			var showText = function(text) {
				Shadowbox.open({
					content:  "<div class=\"box\">" +
									  "<h2>Received Text</h2>" +
										"<textarea class='received_text'>" + text + "</textarea>" +
										"</div>",

					player : "html"
				});
      }

      $("#change_name").click( function() {
        var inputname = document.getElementById('client_name');

        inputname.value = myname;

        $('#name_select').slideDown();
      });

      $("#set_name").click( function() {
        var inputname = document.getElementById('client_name');

        myname =  inputname.value;

        linccer.setName(myname);

        myname = myname.replace(/</g,"");
        myname = myname.replace(/>/g,"");

        actname.innerHTML =  '<b>App Name: </b>' + myname;

        $('#name_select').slideUp();

      });

		  map.on('position_changed', function() {
				linccer.setEnvironmentCoordinates(map.latitude, map.longitude, 100);
			});
			
			map.on('address_changed', function(address) {
				$("#coordinates").text(address);
			})
		
		  client.on('send', function() {
        client.connecting();
			});
			
			client.on('receive', function() {
				client.connecting();
			});
			
			client.on('file_selected', function(file) {
				content = fileCache.upload(file);
        client.setContent(content);	
        client.sendmode();
      });

			client.on('file_canceled', function() {
        client.receivemode();
      });
			
			fileCache.on('started', function(url) {
			});
			
			fileCache.on('progress', function(progress) {
			});

			fileCache.on('uploaded', function(uri) {
			});
			
			linccer.on('ready', function() {
        client.displayLocation();
        $("#group").css({"display" : "block"});

      })

			linccer.on('updated_environment', function(data) {
				map.setCenter(data.gps.latitude, data.gps.longitude);

  
      });
			
			linccer.on('sent', function(data) {
        client.showSuccess();
     });

			linccer.on('received', function(data) {
				client.showSuccess();

				var firstContent = data[0]['data'][0];
				
				if (firstContent.type == "text/plain") {
					showText(firstContent.content);
				} else if (firstContent.type == "image/jpeg") {
					showImage(firstContent.uri);
				} else if (firstContent.type == "text/uri-list") {
					showDownload(firstContent.content);
				} else {
					showDownload(firstContent.uri)
				}

			});

      linccer.on('peeked', function(data) {
        
        groupid = data.group_id;

        group = [];
        var a = 0;

        for( i = 0; i < data.group.length; i++)
        {
          if ( data.group[i].id != myid && data.group[i].name != "" ) {
            group[a] = new Object();
            group[a]["id"] =  data.group[i].id;
            group[a]["name"] = data.group[i].name;
            a += 1;
          }
        }

        var groupdiv = document.getElementById("group");
        var groupul = groupdiv.getElementsByTagName("ul")[0];
        var groupli = groupul.getElementsByTagName("li");

        for ( i = 0; i = groupli.length; i++) {
          var groupitem = groupdiv.getElementsByTagName("ul")[0].firstChild;
          groupdiv.getElementsByTagName("ul")[0].removeChild(groupitem);
        }


        for( i = 0; i < group.length; i++)
        {
            var item = document.createElement('li');
              
            var cname = group[i].name.replace(/</g,"");
            cname = cname.replace(/>/g,"");
            item.innerHTML = "<a href='#' name='" + group[i].id + "' onclick='return startApp(this);'>" + cname + "</a>";

            groupul.appendChild(item);
        }



        write_group();
        
        test_for_client();

        linccer.peek(groupid);

      });

      var test_for_client = function () {
        var isthere = false;

        var info = document.getElementById('info');

        for( i = 0; i < group.length; i++)
        {
          if ( group[i].id == selected_clients[0] ) { isthere = true; } else { isthere = false; }
        }

        if ( !isthere ) { 
          info.style.color = "#fff"; 

          info.innerHTML = "<b>Connected to: </b>" + selected_name + " (not connected)";
         
        } else {

          info.style.color = "#fff";
          
          info.innerHTML = "<b>Connected to: </b>" + selected_name;
        }
      }
        
      var write_group = function() {
        var groupdiv = document.getElementById("group");
        var groupul = groupdiv.getElementsByTagName("ul")[0];
        var groupli = groupul.getElementsByTagName("li");

        for ( i = 0; i = groupli.length; i++) {
          var groupitem = groupdiv.getElementsByTagName("ul")[0].firstChild;
          groupdiv.getElementsByTagName("ul")[0].removeChild(groupitem);
        }


        for( i = 0; i < group.length; i++)
        {
            var item = document.createElement('li');
              
            var cname = group[i].name.replace(/</g,"");
            cname = cname.replace(/>/g,"");
            item.innerHTML = "<a href='#' name='" + group[i].id + "' onclick='return startApp(this);'>" + cname + "</a>";

            groupul.appendChild(item);
        }
      }

			linccer.on('error', function(error) {
			  
				if (error.code == 3) {
					$("#coordinates").text(LOCATION_ERROR);
					client.displayLocation();
        } else {
          client.showError(error.message);
        }

      });
  
    });

    var write_info = function(_id) {
      
      infodiv = document.getElementById("info");
      cname = "";

      for( i = 0; i < group.length; i++)
      {
        if ( group[i].id == _id ) {
          selected_name = group[i].name;
        }
      }
      infodiv.innerHTML = "<b>Connected to: </b>" + selected_name;
      infodiv.style.color = "#666";
      
    }
    var startApp = function (link) {
      selected_clients = [];
      selected_clients.push(link.name);
      linccer.setClients(selected_clients);
      write_info(link.name);
      $("#group").css({"display" : "none"});
      $("#webclient").css({"display" : "block"});
      client.setActive();
      client.receivemode();

    }

    var watch = function() {

        if ( client.active() && client.mode() == "receiveMode" ) {
          client.showwaiting();
          linccer.receive( 'one-to-one', { 'waiting': 'true', 'timeout': 5000 } );
        }

    }

    var poke = function() {
        var payload = { 'client' : 'webclient', 'data': [ client.content() ] };

        if ( client.active() && client.mode() == "sendMode" ) {
          client.showwaiting();
          linccer.send("one-to-one", payload);
        }

    }


	</script>
	<script type="text/javascript">
    Shadowbox.init(
    {players: ["html", "iframe", "img"]}
    );
  </script>

	<link rel="stylesheet" href="shadowbox/shadowbox.css" type="text/css" media="screen" title="no title" charset="utf-8">
  <link rel="stylesheet" href="http://hoccer.com/wp-content/themes/hoccer/css/style.css" />
	<style type="text/css" media="screen">

    @media only screen and (max-device-width: 480px) {
      #wrapper, #help_wrapper { 
        max-width : 100%; 
      }
      #title { padding:0; }
    }

    body { background: #DDD url('http://hoccer.com/webapp/images/hoccer_wall_bg.jpg') repeat-x; color: #888;
      padding: 5px;
      font-size: 15px;
    }
    a { font-weight : bold; }
    h1 { 
      font-size: 20px;
      margin-left: 10px;
    }      
    html { text-shadow: 0px -1px #000; -webkit-font-smoothing: antialiased; }
    #wrapper, #help_wrapper { margin : 0 auto; width: 600px; }

    #help_wrapper {
      display : none;
      border-top : 1px solid rgba(0,0,0,0.5);
      border-bottom : 1px solid rgba(0,0,0,0.5);
      border-right : 1px solid rgba(0,0,0,0.25);
      border-left : 1px solid rgba(0,0,0,0.25);
      margin-bottom: 10px; 
      padding-bottom : 10px;
      background-color : rgba(0,0,0,0.2);
      -moz-border-radius: 8px;
      -webkit-border-radius: 8px;
      box-shadow: 0px 1px 0px rgba(255, 255, 255, 0.25), 0px 1px 0px rgba(255, 255, 255, 0.25) inset;
      -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25), 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25), 0 1px 0 rgba(255, 255, 255, 0.25) inset;
    }

    #location  { clear : both; }
    #coordinates { display: none; }
    #webclient { margin: 0 auto; display : none;}
    #group { display : none;}
    #info { margin-top : 10px; }
    .box { 
      margin : 10px 10px;
      border-top : 1px solid rgba(0,0,0,0.5);
      border-bottom : 1px solid rgba(0,0,0,0.5);
      border-right : 1px solid rgba(0,0,0,0.25);
      border-left : 1px solid rgba(0,0,0,0.25);
      margin-bottom: 10px; 
      padding-bottom : 10px; 
      background-color : rgba(0,0,0,0.2);
      -moz-border-radius: 8px;
      -webkit-border-radius: 8px;
      box-shadow: 0px 1px 0px rgba(255, 255, 255, 0.25), 0px 1px 0px rgba(255, 255, 255, 0.25) inset;
      -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25), 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25), 0 1px 0 rgba(255, 255, 255, 0.25) inset;
    }

    .box section { margin-top : 10px;}

    .box section p {
      margin-top: 18px;
      margin-bottom : 10px;
    }

    .box ul {
      margin-left : 0px;
      padding-left : 20px;
      padding-right : 20px;
    }

    .box ul li {
      padding-left: 0px;
      padding-right: 0px;
      padding-top: 10px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0, 0, 0, 0.5);
      list-style-type: none;
    }

    .box ul li:last-child {
      border: none;
    }

    .box ul li br {
      display: none;
    }

    .box ul li p {
      margin-top: 10px;
    }

    .box ul li img {
      float: left;
      margin-right: 20px;
      border: 1px solid #bdbdbd;
      -moz-border-radius: 5px;
      -webkit-border-radius: 5px;
    }

    .box p {
      padding-left: 20px;
      padding-right: 20px;
    }

		#map_canvas { height: 450px; padding-top: 6px;}
		#map_container { position: absolute; padding: 10px; margin-top: -1200px;}
		#map_container { font-size: 15pt;}
		#location #show_map {float: right;}
		
		#location span, #content_select span, .centered span { vertical-align: middle; }
		#location img, #content_select img, .centered img { margin: 0 5px 0 0; padding: 0; vertical-align: middle;}
		#content_select, .centered { font-size: 15pt; }
		
		#transfer_button, #fileInputField { cursor: pointer }

    #textinput {
      vertical-align: center;
      float:right;
      padding:20px;
    }

    #textinput a {
      float : left;
      margin-right : 30px;
    }
		
		#fileinput {
			float: left;
			width: 230px;
		}

    #name_select {
      display : none;
    }
		#content_select {
			text-align: center;
      display: none;
      clear : both;
      margin: 0;
      padding : 0;
      height : 0;
      border : none;
    }

    #help_section {
      clear : both;
      display: none;
    }
		
		#transfer h1 			{ padding: 0 15px 10px; }
		#transfer h1 span { vertical-align: middle; }
		#transfer h1 img 	{ margin: 0 5px 0 0; padding: 0; vertical-align: middle;}
	
		#transfer img#drag { 
      clear : both;
      float: left; 
			margin-left: 15px; 
			border: 1px solid #bdbdbd;
		  -moz-border-radius: 5px;
		  -webkit-border-radius: 5px;
		}
		
    #transfer_text {
      float : right;
      margin-right: 10px;
      height : 50px;
      width : 230px;
    }

		
		#connecting_info {
      width: 100%;
      text-align: center;
      font-weight: bold;
      letter-spacing: 1px;
      border-top: 1px solid rgba(0, 0, 0, 0.5);
      box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      padding-top: 5px;
    }

		#mode_info {
      text-align: center;
      border-top: 1px solid rgba(0, 0, 0, 0.5);
      box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      -webkit-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      -moz-box-shadow: 0 1px 0 rgba(255, 255, 255, 0.25) inset;
      padding: 20px;
    }


		
		#addressForm {
			margin: 10px 0;
		}
		
		div.fileinputs {
			position: relative;
		}

		div.fakefile {
			position: absolute;
			top: 0;
			left: 20px;
			z-index: 1;
    }

		div.textpic {
			float: right;
      padding-right: 20px;
      z-index: 1;
		}


		input.file {
      position: absolute;
      left: 10px;
			
			text-align: right;
			-moz-opacity:0 ;
			filter:alpha(opacity: 0);
			opacity: 0;
			z-index: 2;
			
			height: 45px;	
      width: 150px;

      margin-bottom : 20px;
		}
		
		textarea {
			width: 210px;
			-moz-border-radius: 5px;
		  -webkit-border-radius: 5px;
		  
			background: #F6F6F6;
		}
		
		hr {
			display: block;
			height: 1px;
			border: 0;
			border-top: 1px inset rgba(0,0,0,0.5);
			margin: 0;
			padding: 0;
		}
		
		.box h2 {
			padding-bottom: 15px;
		}
		
		.box textarea {
			width: 450px;
			height: 210px;
		}

    #title { width : 315px; display : block; margin: 0 auto; padding: 20px 0 20px 0; }
    #change_client, #change_name { float : right; }

    #client_name { margin-left : 20px; }

    .clientinfo {
      margin-top : 10px;
    }

    #app_footer { padding : 0; width: 100%; }

    #app_footer ul { margin : 0 }
    #app_footer ul li {
      float : left;
      list-style-type : none;
      margin-left : 10px;
    }

    .transfer_button_info { 
      float : left;
      font-size : 15pt;
      line-height : 35px;
      margin-left : 5px;
    }

    h1.help { width : 100%; text-align : center; font-size : 1.5em; margin-bottom : 40px;}
    h2.help { clear : both; font-size : 1.2em; color : #ddd; margin-bottom : 10px; }
    div.help { margin-bottom : 20px; }
    ol.help { list-style-type : none; font-size : 1em; }
    img.help { float : left; margin-right : 10px; margin-bottom : 10px; }
    div.help ul li { float : right; list-style-type : none; padding : 5px; font-weight : bold; }
	</style>
	
</head>
<!-- paulirish.com/2008/conditional-stylesheets-vs-css-hacks-answer-neither/ -->

<!--[if lt IE 7 ]> <body class="ie6"> <![endif]-->
<!--[if IE 7 ]>    <body class="ie7"> <![endif]-->
<!--[if IE 8 ]>    <body class="ie8"> <![endif]-->
<!--[if IE 9 ]>    <body class="ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <body> <!--<![endif]-->
  <div data-role="page" id="help_wrapper">
      <div data-role="header" id="title">
        <a href="/">
          <img src="images/logo_webapp.png" alt="logo" /></a>
      </div>

      <div data-role="content">
          <h1 class="help">Welcome to Hoccer Webapp</h1>

          <h2 class="help">How to receive</h2>

          <div class="help" id="receive_help">
            <img class="help" id="drag" src="images/drag.jpg" width="200" height="126" alt="Drag">
					  <ol class="help" id="help">
						  <li>Select one Hoccer Client nearby</li>
						  <li>Wait for some incoming images or text. Content has to be swiped out of mobile apps.</li>
							<li>To receive from another client just change the selected client.</li>
						</ol>
          </div>

          <h2 class="help">How to send text</h2>

          <div class="help" id="send_text_help">
            <img class="help" id="drag" src="images/drag.jpg" width="200" height="126" alt="Drag">
					  <ol class="help" id="help">
              <li>Select one Hoccer Client nearby</li>
              <li>Open Inpu Form by clicking "Input Text" in the lower right of the app.</li>
						  <li>Input the Text you want to send and click "Send Text" below the input field.</li>
              <li>You are now sending permanently.</li>
              <li>To stop sending text, just click "cancel" in the info section.</li>
						</ol>
          </div>

          <h2 class="help">How to send images</h2>

          <div class="help" class="help" id="send_text_help">
            <img class="help" id="drag" src="images/drag.jpg" width="200" height="126" alt="Drag">
					  <ol class="help"  id="help">
              <li>Select one Hoccer Client nearby</li>
              <li>Open file selection dialog by clicking "Select File" in the lower left of the app.</li>
						  <li>Choose the image file you want.</li>
              <li>You are now sending permanently.</li>
              <li>To stop sending text, just click "cancel" in the info section.</li>
						</ol>
          </div>

      </div>
      
      <div class="help" data-role="footer">
        <ul>
          <li><a href="#" id="close_help">Close Help</a><li>
        </ul>
      </div>
      <div style="clear:both;"></div>
  </div>
  <div data-role="page" id="wrapper">
      <div data-role="header" id="title">
        <a href="/">
          <img src="images/logo_webapp.png" alt="logo" /></a>
      </div>

      <div id="location" class="box" >
            <h1>Here You Are</h1>
						<section><p><img src="images/webapp_icon_location.png" width="27" height="25" alt="Location">
							<span id="waiting">locating...</span>
							<span id="coordinates"></span>
							<span id="show_map"><a href="#">Change</a></span>
							<div id="map_container">
								<hr />
								<form id="addressForm"><input id="addressInput" type="text" /><input type="Submit" value="search" /></form>
								<div id="map_canvas"></div>
							</div>
						</p></section>
				</div>

        <div class="box" id="group">
          <h1>Select A Partner</h1>
          <p>To Send and Receive File and Text from another Hoccer-Client select one of the Clients nearby.</p>
          <ul>
          </ul>
        </div>

      <div data-role="content" id="webclient">
        <div class="box clientinfo">
          <h1>Thats Your Status</h1>
          <p>
            <span id="info"></span>
            <a id="change_client" href="#">Change</a>
          </p>
          <p>
            <span id="my_name"></span>
            <a id="change_name" href="#">Change</a>
          </p>
          
          <p>
            <div id="mode_info"></div>
            <div id="connecting_info">Connecting..</div>
            <span id="filename" style="margin-left : 20px;">No file selected.</span>
          </p>
        </div><!--.clientinfo-->

        <div class="box" id="name_select">
          <h1>Name Your WebApp</h1>
          <input type="text" id="client_name" value="" placeholder="Enter AppName here...">
          <a id="set_name" href="#">Set Name</a>
        </div><!--name_select-->
			  <div class="box" id="content_select">
            <section>
							<div id="textinput">
                <textarea type="text" id="textcontent" placeholder="Enter text or url ..."></textarea>
                <a href="#" id="set_text">Send Text</a>
              </div>
              </section>
        </div><!--content_select-->

        <div class="box" id="transfer">
						<section>
 							<div id="fileinput" class="fileinputs">
								<input type="file" class="file" id="fileInputField" />
								<div class="fakefile">
									<img style="float:left;margin-top:5px;"; src="images/webapp_icon_selectfile.png"width="52" height="40" alt="Select File">
									<span class="transfer_button_info">Select File</span>
								</div>
							</div>
              <div id="transfer_text">
                <img style="float:left;margin-top:5px;" src="images/webapp_icon_inputtext.png" alt="logo" />
                <span  class="transfer_button_info">Input Text</span>
              </div>
              <br style="clear: both" />
						</section>
				</div><!--transfer-->

      </div><!--webclient-->

      <div data-role="footer" id="app_footer">
          <ul>
            <li><a id="help_link" href="#">Help</a></li>
            <li><a href="http://wall.hoccer.com/">Hoccer Wall</a></li>
            <li><a href="http://hoccer.com/support/">Support</a></li>
            <li><a href="http://hoccer.com/developer/">Developer</a></li>
            <li><a href="http://hoccer.com/blog/">Blog</a></li>
            <li><a href="http://hoccer.com/company/">Company</a></li>
            <li><a href="http://hoccer.com/contact/">Contact</a></li>
            <li><a href="http://www.twitter.com/hoccer"><img src="http://hoccer.com/wp-content/themes/hoccer/images/twitter.png" alt="twitter"/></a></li>
            <li><a href="http://www.facebook.com/hoccer"><img src="http://hoccer.com/wp-content/themes/hoccer/images/facebook.png" alt="facebook"/></a></li>
          </ul>
      </div><!--footer-->

    </div><!--webclient-->


	</div><!--wrapper-->

	<!-- Piwik --> 
	<script type="text/javascript">
	var pkBaseURL = (("https:" == document.location.protocol) ? "https://stats.hoccer.com/" : "http://stats.hoccer.com/");
	document.write(unescape("%3Cscript src='" + pkBaseURL + "piwik.js' type='text/javascript'%3E%3C/script%3E"));
	</script><script type="text/javascript">
	try {
	var piwikTracker = Piwik.getTracker(pkBaseURL + "piwik.php", 5);
	piwikTracker.trackPageView();
	piwikTracker.enableLinkTracking();
	} catch( err ) {}
	</script><noscript><p><img src="http://stats.hoccer.com/piwik.php?idsite=5" style="border:0" alt="" /></p></noscript>
	<!-- End Piwik Tracking Code -->
</body>

</html>
